#!/bin/sh

set -e

test "$#" -eq 1
test -x /usr/bin/pulseaudio
test -x /usr/bin/pactl

if ! /usr/bin/pulseaudio --check; then /usr/bin/pulseaudio --start; sleep 3; fi

SED='/^[[:blank:]]\{1,\}\*[[:blank:]]\{1,\}index:[[:blank:]]\{1,\}\(.*\)$/!d;'

default() {
  COMMAND='s//set-sink-volume \1 100% set-sink-mute \1 0 suspend-sink \1 0/;'
  pacmd list-sinks | sed "${SED}${COMMAND}" | xargs -n3 /usr/bin/pactl
  COMMAND='s//set-source-volume \1 0% set-source-mute \1 1 suspend-source \1 1/;'
  pacmd list-sources | sed "${SED}${COMMAND}" | xargs -n3 /usr/bin/pactl
}

modify() {
  pacmd list-sinks | sed "${SED}${COMMAND}" | xargs /usr/bin/pactl
}

case "$1" in
  default) default ;;
  up) COMMAND='s||set-sink-volume \1 +5%|;'; modify ;;
  down) COMMAND='s||set-sink-volume \1 -5%|;'; modify ;;
  min) COMMAND='s||set-sink-volume \1 50%|;'; modify ;;
  max) COMMAND='s||set-sink-volume \1 100%|;'; modify ;;
  mute) COMMAND='s||set-sink-mute \1 toggle|;'; modify ;;
  *) exit 1 ;;
esac
